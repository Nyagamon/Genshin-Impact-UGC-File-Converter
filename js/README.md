# 原神 UGC 文件转换器 - Web版本

这是原神 (Genshin Impact) UGC 文件转换器的 JavaScript Web 版本，支持在浏览器中直接进行 `.gil` / `.gia` / `.mihoyobin` ⇔ `.json` 格式的相互转换。

## 🌟 特性

- ✅ **纯前端实现**：无需服务器，所有处理都在浏览器本地完成
- 🔒 **隐私安全**：文件不会上传到任何服务器
- 🎨 **现代化UI**：美观的用户界面，支持响应式设计
- 🚀 **即开即用**：直接在浏览器中打开即可使用
- 📦 **支持多种格式**：支持 .gia, .gil, .mihoyobin 和 JSON 格式

## 📁 文件结构

```
js/
├── index.html          # 主页面
├── style.css           # 样式文件
├── app.js             # 主应用逻辑
├── Reader.js          # 二进制读取类
├── Writer.js          # 二进制写入类
├── Util.js            # 工具函数
├── Dtype.js           # 数据类型处理
└── Tson.js            # 核心转换逻辑
```

## 🚀 使用方法

### 1. 直接在浏览器中打开

最简单的方法：
1. 进入 `js` 目录
2. 双击 `index.html` 文件
3. 文件将在默认浏览器中打开

### 2. 使用本地服务器（推荐）

为了避免某些浏览器的跨域限制，建议使用本地HTTP服务器：

**使用 Python：**
```bash
cd js
python -m http.server 8000
```

**使用 Node.js (http-server)：**
```bash
cd js
npx http-server -p 8000
```

然后在浏览器中访问：`http://localhost:8000`

## 📖 操作指南

### 解码模式（二进制 → JSON）

1. 点击 **"📥 解码模式"** 按钮
2. 点击 **"选择输入文件"** 上传 `.gil`、`.gia` 或 `.mihoyobin` 文件
3. （可选）选择对应的 dtype CSV 文件，如不选择将自动尝试使用内置dtype
4. （可选）自定义输出文件名
5. 点击 **"🔄 开始转换"** 按钮
6. 转换完成后，JSON 文件会自动下载

### 编码模式（JSON → 二进制）

1. 点击 **"📤 编码模式"** 按钮
2. 点击 **"选择输入文件"** 上传 `.json` 文件
3. （可选）自定义输出文件名
4. 点击 **"🔄 开始转换"** 按钮
5. 转换完成后，二进制文件会自动下载

## 🔧 技术实现

### 核心类说明

#### Reader
二进制数据读取器，支持：
- 读取 uint8, uint32, float32
- 变长整数编码读取
- 数据块读取

#### Writer
二进制数据写入器，支持：
- 写入 uint8, uint32, float32
- 变长整数编码写入
- 数据块写入

#### Dtype
数据类型定义处理器：
- 解析 CSV 格式的类型定义
- 自动分析二进制数据类型
- 生成类型定义

#### Tson
核心转换逻辑：
- 二进制数据解码为 JSON
- JSON 编码为二进制数据
- 支持 gia/gil/mihoyobin 格式
- 处理加密和字节序转换

### 数据格式

#### GIA/GIL 格式
- Big-endian 字节序
- 带有头部信息
- 包含4个保留字段

#### MiHoYoBin 格式
- 使用 0xE5 异或加密
- 支持多种子类型（BeyondGlobal, Node, TextMap等）

## 🔍 与 C++ 版本的区别

1. **运行环境**：C++ 版本是命令行工具，JS 版本是 Web 应用
2. **数据处理**：JS 使用 Uint8Array 和 DataView 处理二进制数据
3. **整数处理**：JS 使用 BigInt 处理大整数
4. **文件操作**：JS 使用 File API 和 Blob 进行文件读写
5. **用户界面**：提供图形化的网页界面

## ⚠️ 注意事项

1. **文件大小限制**：由于浏览器内存限制，建议处理的文件不要超过 100MB
2. **浏览器兼容性**：建议使用最新版本的 Chrome、Firefox、Edge 或 Safari
3. **Dtype文件**：某些复杂的文件可能需要提供对应的 dtype CSV 文件
4. **隐私安全**：所有处理都在本地完成，文件不会上传到服务器

## 🐛 故障排除

### 转换失败

1. 确认文件格式是否正确
2. 尝试提供对应的 dtype 文件
3. 检查浏览器控制台的错误信息

### 无法选择文件

1. 确认浏览器支持 File API
2. 尝试使用其他浏览器

### dtype 文件加载失败

1. 手动选择对应的 dtype CSV 文件
2. 确认 dtype 文件格式正确

## 📝 许可证

本项目基于 MIT 许可证，与原 C++ 版本保持一致。

## 🙏 致谢

本项目是对原 C++ 版本的 JavaScript 移植，感谢原作者的贡献。

---

**使用愉快！如有问题，欢迎反馈。**
