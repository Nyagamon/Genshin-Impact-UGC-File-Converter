<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•é¡µé¢ - UGC æ–‡ä»¶è½¬æ¢å™¨</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .success { color: green; }
        .error { color: red; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª UGC æ–‡ä»¶è½¬æ¢å™¨ - åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. Reader ç±»æµ‹è¯•</h2>
        <button onclick="testReader()">è¿è¡Œæµ‹è¯•</button>
        <div id="readerResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Writer ç±»æµ‹è¯•</h2>
        <button onclick="testWriter()">è¿è¡Œæµ‹è¯•</button>
        <div id="writerResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Util ç±»æµ‹è¯•</h2>
        <button onclick="testUtil()">è¿è¡Œæµ‹è¯•</button>
        <div id="utilResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>4. Dtype ç±»æµ‹è¯•</h2>
        <button onclick="testDtype()">è¿è¡Œæµ‹è¯•</button>
        <div id="dtypeResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>5. é›†æˆæµ‹è¯•</h2>
        <button onclick="testIntegration()">è¿è¡Œæµ‹è¯•</button>
        <div id="integrationResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>6. è¿›å…¥ä¸»åº”ç”¨</h2>
        <button onclick="window.location.href='index.html'">æ‰“å¼€è½¬æ¢å™¨</button>
    </div>

    <script src="Reader.js"></script>
    <script src="Writer.js"></script>
    <script src="Util.js"></script>
    <script src="Dtype.js"></script>
    <script src="Tson.js"></script>

    <script>
        function testReader() {
            const result = document.getElementById('readerResult');
            try {
                // åˆ›å»ºæµ‹è¯•æ•°æ®
                const data = new Uint8Array([0x01, 0x02, 0x03, 0x04, 0x05]);
                const reader = new Reader(data);

                let tests = [];
                
                // æµ‹è¯• readUint8
                const val1 = reader.readUint8();
                tests.push(`readUint8: ${val1} (æœŸæœ›: 1) ${val1 === 1 ? 'âœ…' : 'âŒ'}`);
                
                // æµ‹è¯• size
                tests.push(`size: ${reader.size} (æœŸæœ›: 5) ${reader.size === 5 ? 'âœ…' : 'âŒ'}`);
                
                // æµ‹è¯• isEof
                tests.push(`isEof: ${reader.isEof} (æœŸæœ›: false) ${!reader.isEof ? 'âœ…' : 'âŒ'}`);

                result.innerHTML = `<div class="success">${tests.join('<br>')}</div>`;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function testWriter() {
            const result = document.getElementById('writerResult');
            try {
                const writer = new Writer();
                
                let tests = [];
                
                // æµ‹è¯• writeUint8
                writer.writeBytes([0x01, 0x02, 0x03]);
                const data1 = writer.getData();
                tests.push(`writeBytes: é•¿åº¦=${data1.length} (æœŸæœ›: 3) ${data1.length === 3 ? 'âœ…' : 'âŒ'}`);
                
                // æµ‹è¯• writeUint32
                const writer2 = new Writer();
                writer2.writeUint32(0x12345678);
                const data2 = writer2.getData();
                tests.push(`writeUint32: é•¿åº¦=${data2.length} (æœŸæœ›: 4) ${data2.length === 4 ? 'âœ…' : 'âŒ'}`);
                
                result.innerHTML = `<div class="success">${tests.join('<br>')}</div>`;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function testUtil() {
            const result = document.getElementById('utilResult');
            try {
                let tests = [];
                
                // æµ‹è¯• Base64 ç¼–ç 
                const data = new Uint8Array([0x48, 0x65, 0x6C, 0x6C, 0x6F]); // "Hello"
                const encoded = Util.base64Encode(data);
                tests.push(`Base64ç¼–ç : ${encoded}`);
                
                // æµ‹è¯• Base64 è§£ç 
                const decoded = Util.base64Decode(encoded);
                const match = decoded.length === data.length;
                tests.push(`Base64è§£ç : é•¿åº¦åŒ¹é…=${match} ${match ? 'âœ…' : 'âŒ'}`);
                
                // æµ‹è¯• crypt
                const encrypted = Util.crypt(data);
                tests.push(`å¼‚æˆ–åŠ å¯†: é•¿åº¦=${encrypted.length} ${encrypted.length === data.length ? 'âœ…' : 'âŒ'}`);
                
                // æµ‹è¯•æ–‡ä»¶æ‰©å±•å
                const ext = Util.getFileExtension('test.gil');
                tests.push(`æ–‡ä»¶æ‰©å±•å: ${ext} (æœŸæœ›: gil) ${ext === 'gil' ? 'âœ…' : 'âŒ'}`);
                
                result.innerHTML = `<div class="success">${tests.join('<br>')}</div>`;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function testDtype() {
            const result = document.getElementById('dtypeResult');
            try {
                const dtype = new Dtype();
                let tests = [];
                
                // æµ‹è¯• CSV è¯»å–
                const csvData = `# æµ‹è¯•æ•°æ®
1,*,int
2,,string
3,,float32`;
                
                const success = dtype.readCsv(csvData);
                tests.push(`CSVè¯»å–: ${success ? 'âœ…' : 'âŒ'}`);
                
                // æµ‹è¯•èŠ‚ç‚¹è·å–
                const node1 = dtype.get([1]);
                tests.push(`è·å–èŠ‚ç‚¹: ${node1 ? 'âœ…' : 'âŒ'}`);
                
                if (node1) {
                    tests.push(`èŠ‚ç‚¹ç±»å‹æ£€æŸ¥: isInt=${node1.isIntUnknown()} ${node1.isIntUnknown() ? 'âœ…' : 'âŒ'}`);
                    tests.push(`å¤šé”®æ£€æŸ¥: ${node1.isMultipleKeys()} ${node1.isMultipleKeys() ? 'âœ…' : 'âŒ'}`);
                }
                
                result.innerHTML = `<div class="success">${tests.join('<br>')}</div>`;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function testIntegration() {
            const result = document.getElementById('integrationResult');
            try {
                let tests = [];
                
                // æµ‹è¯• Tson ç±»åˆ›å»º
                const tson = new Tson();
                tests.push(`Tsonå®ä¾‹åˆ›å»º: âœ…`);
                
                // æµ‹è¯•æ–‡ä»¶ç±»å‹é¢„åŠ è½½
                const preload1 = tson.preloadBtson('test.gil');
                tests.push(`é¢„åŠ è½½.gilæ–‡ä»¶: ${preload1 ? 'âœ…' : 'âŒ'}`);
                tests.push(`æ–‡ä»¶ç±»å‹: ${tson.filetype} (æœŸæœ›: ${Tson.FileType.gil})`);
                
                const tson2 = new Tson();
                const preload2 = tson2.preloadBtson('test.mihoyobin');
                tests.push(`é¢„åŠ è½½.mihoyobinæ–‡ä»¶: ${preload2 ? 'âœ…' : 'âŒ'}`);
                
                // æµ‹è¯•JSONä¿å­˜
                const jsonObj = tson.saveJson();
                tests.push(`ç”ŸæˆJSON: ${jsonObj ? 'âœ…' : 'âŒ'}`);
                tests.push(`JSONåŒ…å«filetype: ${jsonObj.filetype ? 'âœ…' : 'âŒ'}`);
                
                result.innerHTML = `<div class="success">${tests.join('<br>')}<br><br>ğŸ‰ æ‰€æœ‰åŸºç¡€åŠŸèƒ½æ­£å¸¸ï¼å¯ä»¥ä½¿ç”¨ä¸»åº”ç”¨äº†ã€‚</div>`;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
